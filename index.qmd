---
title: "Demo Perfil Taxonómico usando Kraken y BioBackery"
author: "OMICs analysis"
format: 
  html:
    toc: true
    toc-depth: 3
    theme: yeti
    toc-location: left-body
    smooth-scroll: true
    toc-title: "Contenido"
editor: visual
execute:
  engine: knitr
lang: es
---

![](images/logo_OAN_for_white.png){fig-align="center" width="300"}

# Instalaciones

### Kraken

Se realizaron las siguientes descargas directamente desde la terminal:

```{bash, eval=FALSE}
sudo apt update
sudo apt install build-essential g++ libomp-dev wget rsync perl git
sudo apt install zlib1g-dev
```

Posteriormente se clonó el repositorio de `Kraken` para poder instalarlo:

```{bash, eval=FALSE}
cd old 
git clone https://github.com/DerrickWood/kraken2.git
cd kraken2
mkdir -p /home/ubuntu/bin/kraken2
./install_kraken2.sh /home/ubuntu/bin/kraken2
```

La base de datos que se utilizó ya venía previamente indexada, lo cual nos ahorró el paso de generarla desde cero, esta base datos es `Estándar` y contiene lo siguiente: `Refseq archaea, bacteria, viral, plasmid, human, UniVec_Core` y es de fecha 07/14/2025.

```{bash, eval=FALSE}
mkdir -p /home/ubuntu/data/db_standard
cd /home/ubuntu/data/db_standard 
wget https://genome-idx.s3.amazonaws.com/kraken/k2_standard_20250714.tar.gz
tar -xzf k2_standard_20250714.tar.gz
```

### Bracken

```{bash, eval=FALSE}
cd /home/ubuntu/bin
git clone https://github.com/jenniferlu717/Bracken.git
cd src/ && make
```

### HUMAnN y MetaPhlAn

La combinación estable y compatible es HUMAnN 3.8 con MetaPhlAn 4.1 (hay que evitar versiones más nuevas como MetaPhlAn 4.2, que rompen la integración)

```{bash, eval=FALSE}
/home/ubuntu/miniconda3/bin/conda config --add channels defaults
/home/ubuntu/miniconda3/bin/conda config --add channels bioconda
/home/ubuntu/miniconda3/bin/conda config --add channels conda-forge
/home/ubuntu/miniconda3/bin/conda config --add channels biobakery
```

```{bash, eval=FALSE}
/home/ubuntu/miniconda3/bin/conda create -n bakery_env -y
/home/ubuntu/miniconda3/bin/conda init bash
source ~/.bashrc
```

```{bash, eval=FALSE}
conda activate bakery_env
conda install humann=3.8 metaphlan=4.1 -y

```

Preparación de sus respectivas bases de datos:

```{bash, eval=FALSE}
mkdir -p /home/ubuntu/data/humann_db    
mkdir -p /home/ubuntu/data/metaphlan_db 
```

### HUMAnN data

ChocoPhlAn (completa):

```{bash, eval=FALSE}
humann_databases --download chocophlan full /home/ubuntu/data/humann_db --update-config yes 
```

Uniref90:

```{bash, eval=FALSE}
humann_databases --download uniref uniref90_diamond /home/ubuntu/data/humann_db --update-config yes
```

Utility mapping:

```{bash, eval=FALSE}
humann_databases --download utility_mapping full /home/ubuntu/data/humann_db --update-config yes
```

### MetaPhlAn data

Se usó el índice compatible mpa_vOct22_CHOCOPhlAnSGB_202403 (integración con HUMAnN 3.8):

```{bash, eval=FALSE}
metaphlan --install --bowtie2db /home/ubuntu/data/metaphlan_db --index mpa_vOct22_CHOCOPhlAnSGB_202403
```

## Otros softwares:

### SRATools

```{bash, eval=FALSE}

```

### CutAdapt

```{bash, eval=FALSE}

```

### Trimmomatic

```{bash, eval=FALSE}

```

### KneadData

```{bash, eval=FALSE}

```

### BBTools

```{bash, eval=FALSE}

```

# Conjunto de datos

Para este `Demo` utilizamos metagenomas de intestino de humano del estudio "[Gut microbiome composition may be an indicator of preclinical Alzheimer’s disease](https://pmc.ncbi.nlm.nih.gov/articles/PMC10680783/#S8)". Seleccionamos 3 muestras para 2 condiciones distintas, `Sintomas Clínicos de Alzheimer` vs `Control`.

Aqui están los metadatos asociados a cada muestra:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df <- readr::read_csv("tables/SraRunTable.csv")
df$`Sample Name` <- as.character(df$`Sample Name`)

meta_df <- readxl::read_xlsx("tables/NIHMS1945399-supplement-Data_file_S1_version2.xlsx", sheet = 1) 
meta_df$Participant <- as.character(meta_df$Participant)

samples <- c("24882", "62710", "63032", "62568", "63218", "63972")
sb_df <- df[df$`Sample Name` %in% samples, ]
sb_meta <- meta_df[meta_df$Participant %in% samples, ]

all <- dplyr::left_join(sb_df, sb_meta, by = c(`Sample Name` = "Participant"))

gt::gt(all)
```
